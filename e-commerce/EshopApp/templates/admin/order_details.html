{% extends 'admin/admin_base.html' %}
{% load custom_filters %}
{% block body %}
<main id="main" class="main">
  <section class="section">
    <div class="row">
      <div class="col-lg-12">
        <div class="card overflow-auto">
          <div class="card-body">
            <!-- Header -->
            <h2 class="text-center mb-4"><i class="fas fa-box-open"></i> Order Details</h2>
            <hr/>
            <!-- Order Details Card -->
            <div class="card p-4 mb-5">
              <div class="row g-4">
                <!-- Product Details -->
                <div class="col-md-8 border-end">
                  <h5 class="mb-3"><i class="fas fa-shopping-cart"></i> Product Details</h5>
                  {% for product in order.product|get_product %}
                    <div class="d-flex mb-3 align-items-center border-bottom pb-3">
                      <img src="{{ product.image.url }}" alt="product" class="product-image rounded shadow-sm" style="width: 80px; height: 80px; object-fit: cover;">
                      <div class="ms-3 flex-fill">
                        <h6 class="mb-1"><strong>Name:</strong> {{ product.name }}</h6>
                        <p class="mb-0">
                          <strong>Qty:</strong> {% get_qty product.id order.id %} |
                          <strong>Price:</strong> ₹{{ product.price }}
                        </p>
                      </div>
                    </div>
                  {% empty %}
                    <p>No products found for this order.</p>
                  {% endfor %}
                </div>

                <!-- Order Summary -->
                <div class="col-md-4">
                  <h5 class="mb-3"><i class="fas fa-receipt"></i> Order Summary</h5>
                  <p><strong>Order ID:</strong> {{ order.id }}</p>
                  <p><strong>Total:</strong> ₹{{ order.total }}</p>
                  <p><strong>Date:</strong> {{ order.created }}</p>

                  <!-- Order Status -->
                  <div class="mb-3">
                    {% if order.status == 1 %}
                      <span class="badge bg-secondary"><i class="fas fa-receipt"></i> Pending</span>
                    {% elif order.status == 2 %}
                      <span class="badge bg-warning text-dark"><i class="fas fa-cogs"></i> Dispatched</span>
                    {% elif order.status == 3 %}
                      <span class="badge bg-info text-dark"><i class="fas fa-truck-moving"></i> On the Way</span>
                    {% elif order.status == 4 %}
                      <span class="badge bg-success"><i class="fas fa-check-circle"></i> Delivered</span>
                    {% elif order.status == 5 %}
                      <span class="badge bg-danger"><i class="fas fa-times-circle"></i> Cancelled</span>
                    {% elif order.status == 6 %}
                      <span class="badge bg-dark"><i class="fas fa-undo"></i> Returned</span>
                    {% endif %}
                  </div>

                  <!-- Action Buttons -->
                  <div>
                    {% if order.status < 4 %}
                      <a href="/change-order-status/{{ order.id }}/?status=5" class="btn btn-outline-danger btn-sm">
                        <i class="fas fa-times"></i> Cancel Order
                      </a>
                    {% elif order.status == 4 %}
                      <a href="/change-order-status/{{ order.id }}/?status=6" class="btn btn-outline-warning btn-sm">
                        <i class="fas fa-undo"></i> Return Order
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>

              <!-- User Profile Section -->
              <div class="mt-5">
                <h4 class="mb-3"><i class="fas fa-user"></i> User Details</h4>
                <div class="row align-items-center">
                  <div class="col-md-9">
                    <table class="table table-striped table-bordered mb-0">
                      <tr>
                        <th>Full Name</th>
                        <td>{{ order.user.first_name }} {{ order.user.last_name }}</td>
                      </tr>
                      <tr>
                        <th>Email</th>
                        <td>{{ order.user.username }}</td>
                      </tr>
                      <tr>
                        <th>Mobile</th>
                        <td>{{ order.user.profiles.all.0.mobile }}</td>
                      </tr>
                      <tr>
                        <th>Address</th>
                        <td>{{ order.user.profiles.all.0.address }}</td>
                      </tr>
                    </table>
                  </div>
                  <div class="col-md-3 text-center">
                    <img src="{{ order.user.profiles.all.0.image.url }}" class="img-thumbnail rounded shadow" style="width: 150px; height: 150px;" alt="User Image">
                  </div>
                </div>
              </div>
            </div>

          </div> <!-- card-body -->
        </div> <!-- card -->
      </div> <!-- col -->
    </div> <!-- row -->
  </section>
</main>

{% endblock %}
